<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>GAMMA RAY BLASTER</title>
<style>
  @import url('https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap');

  * { margin:0; padding:0; box-sizing:border-box; }

  body {
    background: #030005;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    min-height: 100vh;
    font-family: 'Press Start 2P', monospace;
    overflow: hidden;
  }

  body::before {
    content:''; position:fixed; inset:0;
    background: repeating-linear-gradient(0deg,transparent,transparent 3px,rgba(0,0,0,0.18) 3px,rgba(0,0,0,0.18) 4px);
    pointer-events:none; z-index:200;
  }
  body::after {
    content:''; position:fixed; inset:0;
    background: radial-gradient(ellipse at center, transparent 45%, rgba(0,0,0,0.85) 100%);
    pointer-events:none; z-index:201;
  }

  .title {
    font-size: clamp(9px, 2.5vw, 16px);
    color: #ff00ff;
    text-shadow: 0 0 8px #ff00ff, 0 0 25px #aa00ff, 0 0 60px rgba(255,0,255,0.4);
    letter-spacing: 3px;
    margin-bottom: 6px;
    z-index:10;
    animation: flicker 5s infinite;
  }
  @keyframes flicker {
    0%,88%,100%{opacity:1} 89%{opacity:.3} 91%{opacity:1} 93%{opacity:.4} 95%{opacity:1}
  }

  .subtitle {
    font-size: clamp(5px,1.2vw,8px);
    color: #00ffff;
    text-shadow: 0 0 8px #00ffff;
    margin-bottom: 16px;
    letter-spacing: 4px;
    z-index:10;
  }

  .screen-wrap {
    position:relative; z-index:10;
    border: 3px solid #ff00ff;
    box-shadow:
      0 0 0 3px #000,
      0 0 0 5px #aa00ff,
      0 0 40px rgba(255,0,255,0.35),
      0 0 90px rgba(170,0,255,0.15);
    background: #010005;
    border-radius: 2px;
  }

  .corner { position:absolute; width:20px; height:20px; z-index:12; }
  .corner.tl{top:-4px;left:-4px;border-top:4px solid #aa00ff;border-left:4px solid #aa00ff;}
  .corner.tr{top:-4px;right:-4px;border-top:4px solid #aa00ff;border-right:4px solid #aa00ff;}
  .corner.bl{bottom:-4px;left:-4px;border-bottom:4px solid #aa00ff;border-left:4px solid #aa00ff;}
  .corner.br{bottom:-4px;right:-4px;border-bottom:4px solid #aa00ff;border-right:4px solid #aa00ff;}

  canvas { display:block; cursor: pointer; }

  .hud-row {
    display:flex; justify-content:space-between; align-items:flex-end;
    width:100%; max-width:900px;
    margin-top:14px; z-index:10; padding:0 8px;
  }
  .hud-group { display:flex; gap:28px; align-items:flex-start; }
  .hud-box { display:flex; flex-direction:column; gap:6px; }
  .hud-label { font-size:6px; color:#aa00ff; text-shadow:0 0 5px #aa00ff; }
  .hud-value { font-size:10px; color:#ffffff; text-shadow:0 0 8px #ffffff; }

  button.action-btn {
    font-family: 'Press Start 2P', monospace;
    font-size: 7px;
    background: #0d001a;
    color: #ff00ff;
    border: 2px solid #aa00ff;
    padding: 8px 12px;
    box-shadow: 0 0 10px rgba(170, 0, 255, 0.4);
    cursor: pointer;
    outline: none;
    text-shadow: 0 0 5px #ff00ff;
    transition: all 0.1s;
  }
  button.action-btn:hover {
    background: #2a004d;
    border-color: #ff00ff;
    box-shadow: 0 0 15px rgba(255, 0, 255, 0.6);
  }
  button.action-btn:active {
    transform: scale(0.95);
  }

  .insert-coin {
    font-size:8px; color:#00ffff;
    text-shadow:0 0 10px #00ffff;
    margin-top:16px; z-index:10;
    animation: blink 1.2s step-end infinite;
    letter-spacing:3px;
  }
  @keyframes blink{50%{opacity:0}}
</style>
</head>
<body>

<div class="title">☢ GAMMA RAY BLASTER ☢</div>
<div class="subtitle">ISOMERIC TRANSITION ENGINE</div>

<div class="screen-wrap">
  <div class="corner tl"></div><div class="corner tr"></div>
  <div class="corner bl"></div><div class="corner br"></div>
  <canvas id="c"></canvas>
</div>

<div class="hud-row">
  <div class="hud-group">
    <div class="hud-box">
      <div class="hud-label">SYSTEM CONTROL</div>
      <button class="action-btn" id="resetBtn">RESET TO GROUND STATE</button>
    </div>
  </div>
  <div class="hud-group">
    <div class="hud-box">
      <div class="hud-label">PHOTONS</div>
      <div class="hud-value" id="photonEl">00000</div>
    </div>
    <div class="hud-box" style="text-align: right;">
      <div class="hud-label">SCORE</div>
      <div class="hud-value" id="scoreEl" style="color:#00ffff; text-shadow:0 0 8px #00ffff;">00000000</div>
    </div>
  </div>
</div>

<div class="insert-coin">▶ CLICK CANVAS TO EXCITE NUCLEUS ◀</div>

<script>
  const canvas = document.getElementById('c');
  const ctx = canvas.getContext('2d');
  
  let W, H, CX, CY;
  let score = 0;
  let photonCount = 0;
  
  let energy = 0; // 0 to 100
  const MAX_ENERGY = 100;
  
  let nucleons = [];
  let photons = [];

  function initSize() {
    W = Math.min(window.innerWidth - 40, 900);
    H = Math.min(window.innerHeight * 0.55, 500);
    canvas.width = W;
    canvas.height = H;
    CX = W * 0.5;
    CY = H * 0.55;
  }
  window.addEventListener('resize', initSize);
  initSize();

  // Create MASSIVE nucleus cluster
  function initNucleus() {
    nucleons = [];
    const numNucleons = 150; // Vastly increased count
    for(let i=0; i<numNucleons; i++) {
      // Pack them roughly in a huge sphere
      let radius = Math.cbrt(Math.random()) * 85; // Massive spread
      let angle = Math.random() * Math.PI * 2;
      nucleons.push({
        basex: Math.cos(angle) * radius,
        basey: Math.sin(angle) * radius,
        type: Math.random() > 0.5 ? 'proton' : 'neutron',
        size: 13 + Math.random() * 6 // Huge individual size
      });
    }
    // Sort by Y so they draw nicely layered
    nucleons.sort((a,b) => a.basey - b.basey);
  }

  function updateHUD() {
    document.getElementById('photonEl').innerText = String(photonCount).padStart(5, '0');
    document.getElementById('scoreEl').innerText = String(score).padStart(8, '0');
  }

  // Interaction
  canvas.addEventListener('mousedown', () => {
    energy = Math.min(MAX_ENERGY, energy + 15);
    score += 50;
    updateHUD();
  });

  document.getElementById('resetBtn').addEventListener('click', () => {
    if (energy > 0) {
      // Massive Burst relative to current energy
      let burstAmount = Math.floor((energy / MAX_ENERGY) * 40) + 5;
      for(let i=0; i<burstAmount; i++) {
        let angle = (i / burstAmount) * Math.PI * 2 + (Math.random()*0.2);
        firePhoton(angle);
      }
      score += energy * 10;
      energy = 0;
      updateHUD();
    }
  });

  function firePhoton(angle) {
    photons.push({
      x: CX, y: CY,
      vx: Math.cos(angle) * 5.5,
      vy: Math.sin(angle) * 5.5,
      life: 1.0
    });
    photonCount++;
  }

  function drawProgressBar() {
    let barW = 250;
    let barH = 14;
    let bx = CX - barW / 2;
    let by = 30; // NEAR THE TOP EDGE

    // Border
    ctx.fillStyle = '#0a0014';
    ctx.fillRect(bx, by, barW, barH);
    ctx.strokeStyle = '#aa00ff';
    ctx.lineWidth = 2;
    ctx.strokeRect(bx, by, barW, barH);

    // Fill
    let fillW = (energy / MAX_ENERGY) * barW;
    let fillColor = '#00ffaa'; // Ground/Low
    if (energy > 40) fillColor = '#ffff00'; // Mid
    if (energy > 80) fillColor = '#ff0055'; // Danger/High

    if (energy > 0) {
      ctx.fillStyle = fillColor;
      ctx.shadowBlur = 10;
      ctx.shadowColor = fillColor;
      ctx.fillRect(bx, by, fillW, barH);
      ctx.shadowBlur = 0;
    }

    // Text
    ctx.font = '8px "Press Start 2P"';
    ctx.textAlign = 'center';
    
    let stateText = 'GROUND STATE';
    let textColor = '#00ffaa';
    
    if (energy > 80) { stateText = 'HIGHLY EXCITED METASTABLE'; textColor = '#ff0055'; }
    else if (energy > 0) { stateText = 'EXCITED STATE'; textColor = '#ffff00'; }

    ctx.fillStyle = textColor;
    ctx.shadowBlur = 5;
    ctx.shadowColor = textColor;
    ctx.fillText(stateText, CX, by + barH + 18);
    ctx.shadowBlur = 0;
  }

  function drawNucleus() {
    // Vibration intensity based on energy, slightly stronger for a large mass
    let vibration = (energy / MAX_ENERGY) * 6.5;

    nucleons.forEach(n => {
      let jx = (Math.random() - 0.5) * vibration * 2;
      let jy = (Math.random() - 0.5) * vibration * 2;
      
      let px = CX + n.basex + jx;
      let py = CY + n.basey + jy;

      ctx.beginPath();
      ctx.arc(px, py, n.size, 0, Math.PI * 2);
      
      if (n.type === 'proton') {
        let grad = ctx.createRadialGradient(px, py, 0, px, py, n.size);
        grad.addColorStop(0, '#ffffff');
        grad.addColorStop(0.3, '#ff0055');
        grad.addColorStop(1, '#880022');
        ctx.fillStyle = grad;
      } else {
        let grad = ctx.createRadialGradient(px, py, 0, px, py, n.size);
        grad.addColorStop(0, '#ffffff');
        grad.addColorStop(0.3, '#00aaff');
        grad.addColorStop(1, '#002288');
        ctx.fillStyle = grad;
      }
      
      ctx.shadowBlur = 6;
      ctx.shadowColor = n.type === 'proton' ? '#ff0055' : '#00aaff';
      ctx.fill();
      ctx.shadowBlur = 0;
    });
  }

  function drawPhotons() {
    photons.forEach((ph, i) => {
      ph.x += ph.vx;
      ph.y += ph.vy;
      ph.life -= 0.008; // Slower fade

      if (ph.life <= 0 || ph.x < -100 || ph.x > W+100 || ph.y < -100 || ph.y > H+100) {
        photons.splice(i, 1);
        return;
      }
      
      let len = Math.sqrt(ph.vx*ph.vx + ph.vy*ph.vy);
      let dirX = ph.vx / len;
      let dirY = ph.vy / len;
      let perpX = -dirY; 
      let perpY = dirX;
      
      // Cosmic/Gamma wave parameters
      let steps = 40; 
      let wavelength = 0.6; 
      let maxAmplitude = 6.5; 
      
      let prevX = ph.x;
      let prevY = ph.y;
      
      for(let j=1; j<=steps; j++) {
        let distAlongTail = j * 1.5; 
        let phase = distAlongTail * wavelength;
        
        let taper = 1 - (j / steps);
        let offset = Math.sin(phase) * (maxAmplitude * taper);
        
        let px = ph.x - (dirX * distAlongTail) + (perpX * offset);
        let py = ph.y - (dirY * distAlongTail) + (perpY * offset);
        
        ctx.beginPath();
        ctx.moveTo(prevX, prevY);
        ctx.lineTo(px, py);
        
        ctx.strokeStyle = j % 2 === 0 ? '#ffffff' : '#ff00ff';
        ctx.lineWidth = 4 * taper; 
        ctx.globalAlpha = Math.max(0, taper * ph.life);
        ctx.shadowBlur = 12 * taper;
        ctx.shadowColor = '#ff00ff';
        ctx.stroke();
        
        prevX = px;
        prevY = py;
      }
      
      ctx.globalAlpha = 1.0;
      ctx.shadowBlur = 0;
    });
  }

  function loop() {
    ctx.clearRect(0, 0, W, H);
    
    // Auto-emission logic: higher energy = more frequent gamma ray leaks
    if (energy > 0) {
      let emissionChance = (energy / MAX_ENERGY) * 0.08; 
      if (Math.random() < emissionChance) {
        let angle = Math.random() * Math.PI * 2;
        firePhoton(angle);
        energy -= 1.5; // Emitting a photon slightly lowers energy
        score += 150;
        updateHUD();
      }
    }
    
    // Clamp energy
    if (energy < 0) energy = 0;
    
    drawProgressBar();
    drawPhotons();
    drawNucleus();
    
    requestAnimationFrame(loop);
  }

  initNucleus();
  updateHUD();
  loop();

</script>
</body>
</html>